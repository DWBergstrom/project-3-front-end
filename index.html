<!DOCTYPE html>
<html>
    <head>
      <title>Nozama</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">

      <!-- Do not add `link` tags-->
      <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

      <!-- Do not add `script` tags-->
      <script src="public/vendor.js" type="text/javascript" charset="utf-8" defer></script>
      <script src="public/application.js" type="text/javascript" charset="utf-8" defer></script>

    </head>
    <body>
      <h1>Nozama</h1>
      <form id="sign-up-form">
        <legend>Sign Up!</legend>
        <input required name=credentials[email] type="text" placeholder="Email" />
        <input required name=credentials[password] type="password" placeholder="Password" />
        <input required name=credentials[password_confirmation] type="password" placeholder="Password Confirmation" />
        <input type="submit" />
      </form>
      <br />
      <form id="sign-in-form">
        <legend>Sign In!</legend>
        <input required name=credentials[email] type="text" placeholder="Email" />
        <input required name=credentials[password] type="password" placeholder="Password" />
        <input type="submit" />
      </form>
      <section class="order hidden">
        <br />
        <h2>Your current order status is:</h2><p id="order-status">Nothing in your order yet.</p>
        <h2>Your current order ID is:</h2><p id="order-id">No order ID yet. Add something to your cart!</p>
        <p>Items:  </p><p id="products-in-order"></p>
        <p>Order total:  </p><p id="order-total"></p>
        <!-- <form action="charges" method="POST">
          <script>
            src="https://checkout.stripe.com/checkout.js" class="stripe-button"
            data-key="pk_test_o7jSVV2xJmBWPs9DsgICx8C9"
            data-amount="100"≠
            data-name="Nozama"
            data-description="Order Confirmation"
            data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
            data-locale="auto">≠≠
          </script>
        </form> -->
        <script src="https://checkout.stripe.com/checkout.js"></script>

        <button id="customButton">Purchase</button>

        <script>
        var handler = StripeCheckout.configure({
          key: 'pk_test_o7jSVV2xJmBWPs9DsgICx8C9',
          image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
          locale: 'auto',
          token: function(token) {
            console.log(token)

            // curl https://api.stripe.com/v1/customers \
            //  -u sk_test_k5orqmsiNDI5QaGeGGGzhVmq: \
            //  -d source=tok_1DUK73DdM0iinGDarmvB3ll9 \
            //  -d description="Emily Moore" \
            //  -d email="emily.moore.37@example.com"

            const stripeData = {
                email: 'dwb@db.com',
                source: token,
                amount: '1000',
                currency: 'usd',
                description: 'test'
            }

            const stripeOrder = function (stripeData) {
              return $.ajax({
                url: 'http://localhost:4741' + '/charges',
                headers: {
                  Authorization: 'Bearer sk_test_k5orqmsiNDI5QaGeGGGzhVmq'
                },
                method: 'POST',
                data: stripeData
              })
            }

            stripeOrder(stripeData)

            // You can access the token ID with `token.id`.
            // Get the token ID to your server-side code for use.
          }
        });

        document.getElementById('customButton').addEventListener('click', function(e) {
          // Open Checkout with further options:
          handler.open({
            name: 'Nozama',
            description: 'Purchase your order',
            amount: 2000
          });
          e.preventDefault();
        });

        // Close Checkout on page navigation:
        window.addEventListener('popstate', function() {
          handler.close();
        });
        </script>
        <button id="cancel-order-button" class="hidden">Cancel Order</button>
        <h2 id="empty-order-message" class="hidden"></h2>
      </section>
      <br />
      <button id="sign-out-button" class="hidden">Sign Out!</button>
      <form id="change-password-form" class="hidden">
        <legend>Change Password!</legend>
        <input required name=passwords[old] type="password" placeholder="Old Password" />
        <input required name=passwords[new] type="password" placeholder="New Password" />
        <input type="submit" />
      </form>
      <br />
      <div id="products">
        <form id="show-product-form" class="hidden">
          <legend>View One Product</legend>
          <input required name="product[id]" type="text" placeholder="ID" />
          <input type="submit" />
        </form>
        <br />
        <div class="container">
          <table class="table table-hover hidden table-striped table-bordered">
            <thead class="thead-light">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody id="product-table" class="product-table"></tbody>
          </table>
        </div>
      </div>
      <div id="order">
        <button id="get-all-orders-button" class="hidden">View Past Orders</button>
        <br />
      </div>
      <h2 id="products-empty-message"class="hidden">There are no products yet!</h2>
      <h2 id="orders-empty-message" class="hidden">There are no items in this order!</h2>
      <h2 id="display-message" class="hidden"></h2>
      <h2 id="display-products" class="hidden"></h2>
      <h2 id="display-orders" class="hidden"></h2>
      <footer>
        <p>Designed by Dave Bergstrom, Derek O'Neil, and Emmet Brault</p>
      </footer>
    </body>
</html>
